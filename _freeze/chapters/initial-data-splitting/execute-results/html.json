{
  "hash": "df37e6338a1fc26e3524060b1709ae16",
  "result": {
    "markdown": "---\nknitr:\n  opts_chunk:\n    cache.path: \"../_cache/whole-game/\"\n---\n\n\n# Initial Data Splitting {#sec-data-splitting}\n\n\n\n\n\n\nIn the previous chapter, Figures [-@fig-model-building-process] and [-@fig-within-model-process] described various operations for the development and evaluation of ML models. We've also emphasized that \"the right data should be used at the right time.\" If the same samples were used for many different purposes, we run the risk of **overfitting**.  Illustrated in @sec-overfitting, this occurs when the model over-interprets irreproducible patterns in the modeling data that don't happen in any other data set. As a result, the model performance statistics are likely to be very optimistic and give us a false sense of how well the model works. If the model were evaluated on a separate set of data (that does not have abnormal patterns), performance would look considerably worse. Because of potential overfitting, the modeler must decide how to best utilize their data across different operations. \n\nThis chapter will examine how we can appropriately utilize our data. Except in @sec-multilevel-splitting, we'll assume that each data set row is statistically independent of the others. Before proceeding further, we'll introduce an example data set used in multiple chapters.  \n\n## The Ames Housing Data {#sec-ames-intro}\n\nThese data, originally published by @ames, are an excellent teaching example. Data were collected for 2,930 houses in Ames, Iowa, via the local assessor's office. A variety of different characteristics of the houses were measured. [Chapter 4](https://www.tmwr.org/ames.html) of @tmwr contains a detailed examination of these data. For illustration, we will focus on a smaller set of predictors, summarized in Tables [-@tbl-ames-numeric] and [-@tbl-ames-categorical]. The geographic locations of the properties are shown in @fig-ames-selection. \n\n\n::: {#tbl-ames-numeric .cell layout-align=\"center\" tbl-cap='A summary of numeric predictors in the Ames housing data.'}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"wsskppophf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#wsskppophf table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#wsskppophf thead, #wsskppophf tbody, #wsskppophf tfoot, #wsskppophf tr, #wsskppophf td, #wsskppophf th {\n  border-style: none;\n}\n\n#wsskppophf p {\n  margin: 0;\n  padding: 0;\n}\n\n#wsskppophf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#wsskppophf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#wsskppophf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#wsskppophf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#wsskppophf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wsskppophf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wsskppophf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wsskppophf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#wsskppophf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#wsskppophf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#wsskppophf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#wsskppophf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#wsskppophf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#wsskppophf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#wsskppophf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#wsskppophf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#wsskppophf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#wsskppophf .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#wsskppophf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wsskppophf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#wsskppophf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#wsskppophf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#wsskppophf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wsskppophf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#wsskppophf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#wsskppophf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wsskppophf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wsskppophf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#wsskppophf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wsskppophf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#wsskppophf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wsskppophf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wsskppophf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wsskppophf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wsskppophf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wsskppophf .gt_left {\n  text-align: left;\n}\n\n#wsskppophf .gt_center {\n  text-align: center;\n}\n\n#wsskppophf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#wsskppophf .gt_font_normal {\n  font-weight: normal;\n}\n\n#wsskppophf .gt_font_bold {\n  font-weight: bold;\n}\n\n#wsskppophf .gt_font_italic {\n  font-style: italic;\n}\n\n#wsskppophf .gt_super {\n  font-size: 65%;\n}\n\n#wsskppophf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#wsskppophf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#wsskppophf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#wsskppophf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#wsskppophf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#wsskppophf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#wsskppophf .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Column\">Column</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Min\">Min</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Median\">Median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Max\">Max</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Std. Dev.\">Std. Dev.</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Skewness\">Skewness</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Baths</td>\n<td headers=\"Min\" class=\"gt_row gt_right\">     0.0</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">      2.0</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">      5.0</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\">     0.64</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\"> 0.3</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Gross Living Area</td>\n<td headers=\"Min\" class=\"gt_row gt_right\">   334.0</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">  1,442.0</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">  5,642.0</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\">   505.51</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\"> 1.3</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Latitude</td>\n<td headers=\"Min\" class=\"gt_row gt_right\">    42.0</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">     42.0</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">     42.1</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\">     0.02</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\">-0.5</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Longitude</td>\n<td headers=\"Min\" class=\"gt_row gt_right\">   -93.7</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">    -93.6</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">    -93.6</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\">     0.03</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\">-0.3</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Lot Area</td>\n<td headers=\"Min\" class=\"gt_row gt_right\"> 1,300.0</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">  9,436.5</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">215,245.0</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\"> 7,880.02</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\">12.8</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Sale Price</td>\n<td headers=\"Min\" class=\"gt_row gt_right\">12,789.0</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">160,000.0</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">755,000.0</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\">79,886.69</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\"> 1.7</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Year Built</td>\n<td headers=\"Min\" class=\"gt_row gt_right\"> 1,872.0</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">  1,973.0</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">  2,010.0</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\">    30.25</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\">-0.6</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Year Sold</td>\n<td headers=\"Min\" class=\"gt_row gt_right\"> 2,006.0</td>\n<td headers=\"Median\" class=\"gt_row gt_right\">  2,008.0</td>\n<td headers=\"Max\" class=\"gt_row gt_right\">  2,010.0</td>\n<td headers=\"Std. Dev.\" class=\"gt_row gt_right\">     1.32</td>\n<td headers=\"Skewness\" class=\"gt_row gt_right\"> 0.1</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n::: {#tbl-ames-categorical .cell layout-align=\"center\" tbl-cap='A summary of categorical predictors in the Ames housing data.'}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"zgkwbyruhf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#zgkwbyruhf table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#zgkwbyruhf thead, #zgkwbyruhf tbody, #zgkwbyruhf tfoot, #zgkwbyruhf tr, #zgkwbyruhf td, #zgkwbyruhf th {\n  border-style: none;\n}\n\n#zgkwbyruhf p {\n  margin: 0;\n  padding: 0;\n}\n\n#zgkwbyruhf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#zgkwbyruhf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#zgkwbyruhf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#zgkwbyruhf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#zgkwbyruhf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#zgkwbyruhf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#zgkwbyruhf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#zgkwbyruhf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#zgkwbyruhf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#zgkwbyruhf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#zgkwbyruhf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zgkwbyruhf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#zgkwbyruhf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#zgkwbyruhf .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#zgkwbyruhf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zgkwbyruhf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#zgkwbyruhf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#zgkwbyruhf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#zgkwbyruhf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zgkwbyruhf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#zgkwbyruhf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zgkwbyruhf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#zgkwbyruhf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zgkwbyruhf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zgkwbyruhf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zgkwbyruhf .gt_left {\n  text-align: left;\n}\n\n#zgkwbyruhf .gt_center {\n  text-align: center;\n}\n\n#zgkwbyruhf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#zgkwbyruhf .gt_font_normal {\n  font-weight: normal;\n}\n\n#zgkwbyruhf .gt_font_bold {\n  font-weight: bold;\n}\n\n#zgkwbyruhf .gt_font_italic {\n  font-style: italic;\n}\n\n#zgkwbyruhf .gt_super {\n  font-size: 65%;\n}\n\n#zgkwbyruhf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#zgkwbyruhf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#zgkwbyruhf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#zgkwbyruhf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#zgkwbyruhf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#zgkwbyruhf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#zgkwbyruhf .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Column\">Column</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"# Values\"># Values</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Most Frequent (n)\">Most Frequent (n)</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Least Frequent (n)\">Least Frequent (n)</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Building Type</td>\n<td headers=\"# Values\" class=\"gt_row gt_right\">5</td>\n<td headers=\"Most Frequent (n)\" class=\"gt_row gt_left\">Single-Family Detached (2425)</td>\n<td headers=\"Least Frequent (n)\" class=\"gt_row gt_left\">Two-Family Conversion (62)</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Central Air</td>\n<td headers=\"# Values\" class=\"gt_row gt_right\">2</td>\n<td headers=\"Most Frequent (n)\" class=\"gt_row gt_left\">Yes (2734)</td>\n<td headers=\"Least Frequent (n)\" class=\"gt_row gt_left\">No (196)</td></tr>\n    <tr><td headers=\"Column\" class=\"gt_row gt_left\">Neighborhood</td>\n<td headers=\"# Values\" class=\"gt_row gt_right\">28</td>\n<td headers=\"Most Frequent (n)\" class=\"gt_row gt_left\">North Ames (443)</td>\n<td headers=\"Least Frequent (n)\" class=\"gt_row gt_left\">Landmark (1)</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nAs shown in @tbl-ames-numeric, the sale price distribution is fairly right-skewed. For this reason, and because we do not want to be able to predict negative prices, the outcome is analyzed on the log (base-10) scale.\n\n\n## Training and Testing Sets  {#sec-train-test}\n\nOne of the first decisions to make when modeling is to decide which samples will be used to evaluate performance. We should evaluate the model with samples not used to build or fine-tune it to obtain an unbiased sense of model effectiveness. When a \"large enough\" amount of data is at hand, a selection of samples can be set aside to evaluate the final model. The **training data** set is the general term for the samples used to create the model. The remaining samples, or a selection of the remaining samples, are placed in the **testing data** set.  The testing data set is exclusively used to quantify how well the model works on an independent set of data. It should only be accessed once to validate the final model candidate.  \n\nHow much data should be allocated to the training and testing sets? This depends on several characteristics, such as the total number of samples, the distribution of the response, and the type of model to be built.  For example, the smaller the total number of samples, the greater the percentage that will need to be selected for the training set.  Similarly, suppose the outcome is binary, and one class has fewer samples than the other. In that case, the number of samples selected for training will depend on the number of samples in the minority class.  Finally, the more tuning parameters required for a model, the larger the training set sample size will need to be. \n In general, a decent rule of thumb is that 75% could be used from training. \n\nWhen the number of samples is small, a strong case can be made that a test set should be avoided because every sample may be needed for model building. Additionally, the size of the test set may not have sufficient power or precision to make reasonable judgments. Several researchers [@Molinaro2005p47; @Martin1996p52; @Hawkins2003p2906]  show that validation using a single test set can be a poor choice. @Hawkins2003p2906 concisely summarizes this point:\n\n\n> \"hold-out samples of tolerable size [...] do not match the cross-validation itself for reliability in assessing model fit and are hard to motivate\".  \n\nThere are tools for gauging model performance using the training set; resampling methods (@sec-resampling) are an effective tool that indicates if overfitting is occurring. Although resampling techniques can be misapplied, such as the example shown in @Ambroise2002p1493, they often produce performance estimates superior to a single test set because they evaluate many alternate versions of the data.\n\n:::{.callout-important}\nOverfitting is the greatest danger in predictive modeling. It can occur subtly and silently. You cannot be too paranoid about overfitting. \n:::\n\nFor this reason, it is crucial to have a systematic plan for using the data during modeling and ensure that everyone sticks to the program. This can be particularly important in cases where the modeling efforts are collaborations between multiple people or institutions. We have had experiences where a well-meaning person included the test set during model training and showed stakeholders artificially good results. For these situations, it might be a good idea to have a third party split the data and blind the outcomes of the test set. In this way, we minimize the possibility of accidentally using the test set (or people peeking at the test set results).  \n\n## Information Leakage  {#sec-leakage}\n\nInformation leakage (a.k.a data leakage) is another aspect of data handling to consider at the onset of a modeling project. This occurs when the model has access to data that it should not. For example, \n\n* Using the distribution of the predictor data in the test set (or other future data) to inform the model.\n* Including identical or statistically related data in training _and_ test sets.\n* Exploiting inadvertent features that are situationally confounded with the outcome.\n\nAn example of the last item we experienced may be familiar to some readers. A laboratory was producing experimental results to evaluate the difference between two treatments on a particular cell type. The laboratory was under time constraints due to an impending move to another building. They prioritized these samples since the new treatment data was the most interesting. Once finished, they moved to their new home and processed the samples from the standard treatment. \n\nOnce the data were examined, there was an enormous difference between the two treatment sets. Fortuitously, one sample was processed twice - before and after they moved. The two replicate data points for this biological sample also showed a large difference, that the signal seen in the data was potentially driven by the changes incurred by the laboratory move. \n\nThis type of issue can frequently occur. See, for example, @bioinformaticsbtg484, @kaufman2012leakage, or @kapoor2023leakage.\n\nAnother example occurs in the Ames housing data set. These data were produced by the local assessor's office, whose job is to appraise the house and estimate the property's value. The data set contains several quality fields for things like the heating system, kitchen, fireplace, garage, and so on. These are subjective results based on the assessor’s experience. These variables are in a qualitative, ordinal format:  \"poor\", \"fair\", \"good\", etc. While these variables correlate well with the sale price, they are actually outcomes and not predictors. For this reason, it is inappropriate to use them as indpendent variables.  \n\nFinally, the test set must emulate the data that will be seen \"in the wild\", i.e., in future samples. We have had experiences where the person in charge of the initial data split had a strong interest in putting the \"most difficult\" samples in the test set. The prevalence of such samples should be consistent with their prevalence in the population that the model is predicting. \n\n## Simple Data Splitting  {#sec-basic-splitting}\n\nWhen splitting the data, it is vital to think about the model's purpose and how the predictions will be used. The most important issue is whether the model will predict the same population found in the current data collection. For example, for the Ames data, the purpose is to predict new houses in the town. This definition implies a measure of interpolation since we are primarily concerned with what is happening in Ames. The existing data capture the types of properties that might be seen in the future.\n\nAs a counter-example, [Chapter 4](https://bookdown.org/max/FES/chicago-intro.html) of @fes highlights a prediction problem in which a model is used to predict the future ridership of commuters on the Chicago elevated trains. This data set has daily records of how many commuters ride the train, and temporal factors highly affect the patterns. In this case, the population we will predict is future ridership. Given the heavy influence of time on the outcome, this implies that we will be extrapolating outside the range of existing data. \n\nIn cases of temporal extrapolation, the most common approach to creating the training and testing set is to keep the most recent data in the test set. In general, it is crucial to have the data used to evaluate the model be as close to the population to be predicted. For times series data, a deterministic split is best for partitioning the data. \n\nWhen interpolation is the focus, the simplest way to split the data into a training and test set is to take a simple random sample. If we desire the test set to contain 25{{< pct >}} of the data, we randomly generate an appropriately sized selection of row numbers to allocate sales to the test set. The remainder is placed in the training set. \n\nWhat is the appropriate percentage? Like many other problems, this depends on the characteristics of the data (e.g., size) and the modeling context. Our general rule of thumb is that one-fourth of the data can go into testing. The criticality of this choice is driven by how much data is available. The split size is not terribly important if a massive amount of data is available. When data are limited, deciding how much data to withhold from training can be challenging. \n\n@Martin2012hr compares different methods of splitting data, including random sampling, dissimilarity sampling, and other methods.\n\n## Using the Outcome {#sec-split-with-outcome}\n\nSimple random sampling does not control for any data attributes, such as the percentage of data in the classes. When one class has a disproportionately small frequency compared to the others (discussed in @sec-imbalances), the distribution of the outcomes may be substantially different between the training and test sets.\n\nWhen splitting the data, stratified random sampling [@Kohavi1995p57] applies random sampling within sub-groups (such as the classes) to account for the outcome. In this way, there is a higher likelihood that the outcome distributions will match. When an outcome is a number, we use a similar strategy; the numeric values are broken into similar groups (e.g., low, medium, and high) and execute the randomization within these groups.\n\nLet's use the Ames data to demonstrate stratification. The outcome is the sale price of a house. @fig-ames-splitting(a) shows the distribution of the outcomes with vertical lines that separate 20{{< pct >}} partitions of the data. Panel (b) shows that the outcome distributions are nearly identical after partitioning into training and testing sets. \n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![(a) A density plot of the sale price of houses in Ames with vertical lines that indicate regions that cover 20{{< pct >}} of the data. The 'rug' on the axis shows the individual data points. (b) Density plots of the training set outcomes (solid red) and test set outcomes (dashed blue) for the Ames data.](../figures/fig-ames-splitting-1.svg){#fig-ames-splitting fig-align='center' width=95%}\n:::\n:::\n\n\n## Using the Predictors  {#sec-split-with-predictors}\n\nAlternatively, we can split the data based on the predictor values. @Willett1999p8 and @Clark1997p1352 proposed data splitting based on _maximum dissimilarity sampling_. The dissimilarity between two samples can be measured in several ways. The simplest method uses the distance between the predictor values for two samples. If the distance is small, the points are nearby. Larger distances between points are indicative of dissimilarity.  To use dissimilarity as a tool for data splitting, we should initialize the training set with a single sample. We calculate the dissimilarity between this initial sample and the unallocated samples. The unallocated sample that is most dissimilar is added to the training set. A method is needed to allocate more instances to the training set to determine the dissimilarities between _groups_ of points (i.e., the two in the training set and the unallocated points). One approach is to use the average or minimum of the dissimilarities. For example, to measure the dissimilarities between the two samples in the training set and a single unallocated point, we can determine the two dissimilarities and average them. The third point added to the training is chosen as having the maximum average dissimilarity to the existing set. This process continues until we achieve the targeted training set size.\n\n@fig-ames-selection illustrates this process for the Ames housing data. Starting with a data point near the middle of the town, dissimilarity sampling selected 50 data points using scaled longitude and latitude as predictors.  As the sampling proceeds, the algorithm initially chooses samples near the outskirts of the data, especially if they are outliers. Overall, the selected data points cover the space with no redundancy.  \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Maximum dissimilarity sampling of 25 points in the Ames data. The small black circles are individual properties. Larger, lighter colors indidicate earlier selection.](../premade/anime_ames_selection.gif){#fig-ames-selection fig-align='center' width=70%}\n:::\n:::\n\n\nFor this example, the two predictors used for splitting were numeric. In this case, we typically use simple distance functions to define dissimilarity. Many other functions are possible. The Gower distance [@gower] is a good alternative when a data set has non-numeric predictors. @sec-cls-knn discusses this metric in more detail. \n\n::: {.callout-warning}\n\nWhile this analysis nicely illustrates the dissimilarity sampling process, it is flawed since it ignores the issue of spatial autocorrelation [@mahoney2023assessing]. This is the idea that things close to one another act more similarly than objects farther away. @sec-spatial-resampling discusses this data-splitting issue in more detail. \n\n:::\n\nThere are various other methods to split the data using the predictor set. For example, @kennard1969computer describes an algorithm that attempts to sequentially select points to be uniformly distributed in the space defined by the splitting variables. Similarly, @vakayil2022data proposed a data splitting method called _twinning_, where a split of the data is sought that minimizes an aggregate distance between points in the training and testing set. Twinning uses the energy distance of @szekely2013energy, which measures the equality of distributions, to make the two data sets similar. Any variables can be used in the distance calculations.\n\n## Multi-Level Data  {#sec-multilevel-splitting}\n\nThere are cases where the rows of a data set may not be statistically independent. This often occurs when multiple data points are collected on individual people, such as\n\n* Patients in medical studies may have data collected over time. \n* Purchase histories of individual customers in a retail database. \n\nIn these and other situations, the data within a person tend to be correlated. This means that the data from a specific person has a higher correlation than data between people. There are many names for this type of data: multi-level data, hierarchical data, longitudinal data, random effect data, profile data, functional data, and so on. In some cases, there are multiple layers of data hierarchies.  \n\nNote that the variable that indicates the person is generally not a predictor; we would not be making predictions about individual people. People, in this example, are sampled from the broader population.  In this case, we are more concerned with the population rather than the individuals sampled from that population. \n\nThis aspect of the data differentiates it from the neighborhood\tpredictor in the Ames data. The houses within each neighborhood may be more similar to one another than houses between neighborhoods. However, the difference is that we want to make predictions using information from these specific neighborhoods. Therefore, we will include neighborhood as a predictor since the individual neighborhoods are not a selected subset of those in the town; instead, the data contain all of the neighborhoods currently in the city.^[If you are familiar with non-Bayesian approaches to multi-level data, such as mixed effects models, this is the same as the difference between random and fixed effects. ]\n\n[Chapter 9](https://bookdown.org/max/FES/profile-data.html) of @fes has a broad discussion on this topic with an illustrative example. \n\nWhen splitting multi-level data into a training and test set, the data are split at the subject level (as opposed to the row level). Each subject would have multiple rows in the data, and all of the subject’s rows must be allocated to either the training or the test set. In essence, we conduct random sampling on the subject identifiers to partition the data, and all of their data are added to either the training or test set. \n\nIf stratification is required, the process becomes more complicated. Often, the outcome data can vary within a subject. To stratify to balance the outcome distribution, we need a way to quantify the outcome per subject. For regression models, the mean of each subject's outcome might be an excellent choice to summarize them. Analogously, the mode of categorical outcomes may suffice as an input into the stratification procedure.  \n\n## Validation Sets  {#sec-three-way-split}\n\nAs previously discussed, validation sets are a separate partition of the data that function as a precursor for the testing set. It allows us to obtain performance estimates on our model(s) during the development cycle. These are commonly used in deep learning and other domains where the initial data sizes range from very large to massive. This additional partition is often created simultaneously with the training and testing sets. \n\nValidation sets serve the same purpose as resampling methods described in @sec-resampling and we can consider them single resamples of the training data. Methods like bootstrapping or cross-validation use many alternative versions of the training set to compute performance statistics. When our data are extensive, multiple resamples are computationally expensive without significantly improving the precision of our estimates. \n\nWithout loss of generalization, we will treat the validation set as a particular case of resampling where there is a single resample of the training set. This difference is not substantive and allows us to have a common framework for measuring model efficacy (before the testing set).\n\nWe’ll see validation sets discussed in @sec-validation and used in Sections TODO and TODO.\n\n## Chapter References {.unnumbered}\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}